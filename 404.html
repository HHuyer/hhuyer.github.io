import { useState, useEffect, useCallback, useRef } from "react";
import { StarField } from "./components/StarField";
import { FloatingAstronaut } from "./components/FloatingAstronaut";
import { GlitchText } from "./components/GlitchText";
import { Portal } from "./components/Portal";
import { Particles } from "./components/Particles";
import Gate from "./components/Gate";

const funnyMessages = [
  "Looks like this page took a wrong turn at the Milky Way ğŸŒŒ",
  "Houston, we have a problem... this page doesn't exist ğŸš€",
  "This page is on vacation in another dimension ğŸŒ€",
  "404: Page not found, but you found something cool! âœ¨",
  "The page you're looking for is in another castle ğŸ°",
  "This page went to get milk and never came back ğŸ¥›",
  "Even Google can't find this page ğŸ”",
  "This page has been abducted by aliens ğŸ‘½",
  "Error 404: Page went to space without a helmet ğŸª",
  "The internet hamster powering this page fell asleep ğŸ¹",
];

export function App() {
  const [messageIndex, setMessageIndex] = useState(0);
  const [showPortal, setShowPortal] = useState(false);
  const [clickCount, setClickCount] = useState(0);
  const [easterEgg, setEasterEgg] = useState(false);
  const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
  const [showGate, setShowGate] = useState(false);
  const [isNavigating, setIsNavigating] = useState(false);
  const containerRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const interval = setInterval(() => {
      setMessageIndex((i) => (i + 1) % funnyMessages.length);
    }, 4000);
    return () => clearInterval(interval);
  }, []);

  const handleMouseMove = useCallback((e: React.MouseEvent) => {
    setMousePos({ x: e.clientX, y: e.clientY });
  }, []);

  const handle404Click = () => {
    setClickCount((c) => c + 1);
    if (clickCount >= 9) {
      setEasterEgg(true);
      setTimeout(() => setEasterEgg(false), 3000);
      setClickCount(0);
    }
  };

  const handleShowGate = () => {
    setShowGate(true);
  };

  const handleGateEnter = () => {
    // Start the warp animation
    setIsNavigating(true);
    
    // After animation, redirect to /index
    setTimeout(() => {
      window.location.href = "/index";
    }, 2500);
  };

  return (
    <div
      ref={containerRef}
      onMouseMove={handleMouseMove}
      className="relative min-h-screen overflow-hidden bg-gradient-to-b from-[#0a0a2e] via-[#16163a] to-[#0d0d2b] text-white select-none"
    >
      {/* Animated Star Background */}
      <StarField isWarping={isNavigating} />

      {/* Mouse trail particles */}
      <Particles mousePos={mousePos} />

      {/* Gate overlay - shows when user wants to go home */}
      {showGate && !isNavigating && (
        <Gate onEnter={handleGateEnter} />
      )}

      {/* 404 Content Container - fades out on navigate */}
      <div 
        className={`transition-all duration-1000 ease-in-out ${
          isNavigating ? "opacity-0 scale-150 blur-sm" : showGate ? "opacity-30 blur-sm pointer-events-none" : "opacity-100 scale-100"
        }`}
      >
        {/* Floating gradient orbs */}
        <div className="pointer-events-none absolute inset-0 overflow-hidden">
          <div className="absolute -left-32 top-1/4 h-64 w-64 animate-pulse rounded-full bg-purple-600/20 blur-3xl" />
          <div className="absolute -right-32 top-1/2 h-96 w-96 rounded-full bg-blue-600/15 blur-3xl" style={{ animation: "pulse 4s ease-in-out infinite" }} />
          <div className="absolute bottom-1/4 left-1/3 h-72 w-72 rounded-full bg-pink-600/10 blur-3xl" style={{ animation: "pulse 6s ease-in-out infinite" }} />
        </div>

        {/* Main Content */}
        <div className="relative z-10 flex min-h-screen flex-col items-center justify-center px-4 py-12">
          {/* Astronaut */}
          <FloatingAstronaut />

          {/* 404 Number */}
          <div className="mb-2 mt-4 cursor-pointer" onClick={handle404Click}>
            <GlitchText text="404" />
          </div>

          {easterEgg && (
            <div className="mb-4 animate-bounce rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 px-6 py-2 text-sm font-bold text-black shadow-lg shadow-yellow-500/30">
              ğŸ‰ You found the easter egg! You're persistent! ğŸ¥š
            </div>
          )}

          {/* Rotating funny message */}
          <div className="mb-8 h-8 overflow-hidden">
            <p
              key={messageIndex}
              className="text-center text-lg font-medium text-purple-200/90 md:text-xl"
              style={{
                animation: "fadeSlideIn 0.5s ease-out",
              }}
            >
              {funnyMessages[messageIndex]}
            </p>
          </div>

          {/* Buttons */}
          <div className="flex flex-wrap items-center justify-center gap-4">
            <button
              onClick={handleShowGate}
              disabled={showGate}
              className="group relative overflow-hidden rounded-xl bg-gradient-to-r from-purple-600 to-indigo-600 px-8 py-3 font-semibold text-white shadow-lg shadow-purple-500/25 transition-all duration-300 hover:scale-105 hover:shadow-xl hover:shadow-purple-500/40 disabled:cursor-not-allowed disabled:opacity-50"
            >
              <span className="relative z-10">ğŸ  Take Me Home</span>
              <div className="absolute inset-0 bg-gradient-to-r from-pink-600 to-purple-600 opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
            </button>

            <button
              onClick={() => setShowPortal(!showPortal)}
              disabled={showGate}
              className="group relative overflow-hidden rounded-xl border-2 border-cyan-500/50 bg-cyan-950/30 px-8 py-3 font-semibold text-cyan-300 backdrop-blur-sm transition-all duration-300 hover:scale-105 hover:border-cyan-400 hover:bg-cyan-900/40 hover:text-white hover:shadow-lg hover:shadow-cyan-500/25 disabled:cursor-not-allowed disabled:opacity-50"
            >
              <span className="relative z-10">{showPortal ? "ğŸŒ€ Close Portal" : "ğŸŒ€ Show Me a Portal"}</span>
            </button>
          </div>

          {/* Portal Animation */}
          {showPortal && <Portal onNavigate={handleShowGate} />}

          {/* Fun counter */}
          <div className="mt-8 text-center text-xs text-white/30">
            <p>Click the 404 text {10 - clickCount} more times for a surprise ğŸ‘€</p>
          </div>

          {/* Keyboard/drag hint */}
          <div className="mt-4 flex flex-col items-center gap-2 text-xs text-white/20">
            <div className="flex items-center gap-2">
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">â†‘</kbd>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">â†“</kbd>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">â†</kbd>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">â†’</kbd>
              <span>or</span>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">W</kbd>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">A</kbd>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">S</kbd>
              <kbd className="rounded border border-white/10 bg-white/5 px-2 py-0.5 font-mono">D</kbd>
            </div>
            <span>Move the astronaut with keys or drag it around! ğŸš€</span>
          </div>
        </div>
      </div>
      
      {/* Hyperdrive Flash Overlay */}
      <div 
        className={`pointer-events-none fixed inset-0 z-[100] bg-white transition-opacity duration-500 ease-in ${
          isNavigating ? "opacity-100 delay-[1.5s]" : "opacity-0"
        }`} 
      />
    </div>
  );
}
