<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chill Home Page</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background-color: #000;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #ffffff;
    }

    header h1 {
      font-size: 3rem;
      margin-bottom: 0.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.4);
    }

    .content {
      text-align: center;
      max-width: 600px;
      margin: auto;
    }

    .content p {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }

    .chill-svg {
      margin: 20px auto;
      display: block;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    button#moodButton {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      background-color: #ffffff;
      color: #2575fc;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    button#moodButton:hover {
      background-color: #e0e0e0;
    }

    #quote {
      margin-top: 20px;
      font-size: 1.2rem;
      font-style: italic;
    }

    .big-time {
      font-size: 4rem;
      text-align: center;
      margin: 0;
    }

    .time-spent {
      font-size: 1rem;
      text-align: center;
      margin-top: 0.5rem;
      opacity: 0.8;
    }

    footer {
      position: absolute;
      bottom: 10px;
      width: 100%;
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.7;
    }

    #bgVideo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .nav-buttons {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 15px;
      z-index: 100;
    }

    .nav-button {
      padding: 10px 20px;
      font-size: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background-color: transparent;
      color: white;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
      text-decoration: none;
      backdrop-filter: blur(0);
      box-shadow: none;
      font-weight: 500;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
    }

    .nav-button:hover {
      background-color: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 7px 14px rgba(0, 0, 0, 0.2),
                  0 3px 6px rgba(0, 0, 0, 0.1);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(8px);
    }

    .nav-button:active {
      transform: translateY(1px) scale(0.98);
      background-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1),
                  0 1px 2px rgba(0, 0, 0, 0.08);
    }

    .nav-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        120deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
      );
      transition: 0.5s;
    }

    .nav-button:hover::after {
      left: 100%;
    }

    .logo {
      position: fixed;
      top: 20px;
      left: 30px;
      font-family: 'Dancing Script', cursive;
      font-size: 2rem;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      z-index: 100;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .logo:hover {
      transform: scale(1.05);
      text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
    }

    .audio-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 100;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .audio-icon {
      width: 24px;
      height: 24px;
    }

    .audio-icon.pause {
      display: none;
    }

    .playing .audio-icon.play {
      display: none;
    }

    .playing .audio-icon.pause {
      display: block;
    }

    .volume-control {
      width: 100px;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px;
      border-radius: 20px;
      display: none;
    }

    .audio-controls:hover .volume-control {
      display: block;
    }

    input[type="range"] {
      width: 100%;
      height: 3px;
      -webkit-appearance: none;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 5px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      cursor: pointer;
    }

    .nav-buttons, .logo, .audio-controls {
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .inactive {
      opacity: 0;
      visibility: hidden;
    }

    .menu-toggle {
      display: none;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 101;
      color: white;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
    }

    .menu-toggle svg {
      width: 24px;
      height: 24px;
    }

    @media (max-width: 768px) {
      .menu-toggle {
        display: block;
      }

      .nav-buttons {
        position: fixed;
        top: 0;
        right: -100%;
        height: 100vh;
        width: 70%;
        max-width: 300px;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        flex-direction: column;
        padding: 80px 20px;
        transition: right 0.3s ease;
      }

      .nav-buttons.active {
        right: 0;
      }

      .logo.menu-active {
        opacity: 0;
        visibility: hidden;
      }
    }

    .chat-container {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 15px;
      backdrop-filter: blur(6px);
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 600px;
      margin: 40px auto;
      transition: all 0.3s ease-in-out;
    }

    .messages-box {
      max-height: 250px;
      overflow-y: auto;
      margin-bottom: 10px;
      padding-right: 10px;
    }

    .input-row {
      display: flex;
      gap: 10px;
    }

    #userInput {
      flex: 1;
      padding: 10px 15px;
      border-radius: 10px;
      border: none;
      outline: none;
      font-size: 1rem;
      background: rgba(255,255,255,0.1);
      color: white;
    }

    #userInput::placeholder {
      color: rgba(255,255,255,0.4);
    }

    button {
      padding: 10px 20px;
      background-color: #2575fc;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #1a5edb;
    }

    /* Chat header for model selection */
    .chat-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .chat-header label {
      font-weight: 600;
      font-size: 1rem;
    }
    .chat-header select {
      padding: 6px 12px;
      border-radius: 5px;
      border: none;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 1rem;
      outline: none;
    }
  </style>
</head>
<body>
  <a href="https://hhuyer.github.io/" class="logo">hhuyer.github.io</a>
  <button class="menu-toggle nav-button">
    <svg viewBox="0 0 24 24">
      <path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
    </svg>
  </button>
  <div class="nav-buttons">
    <a href="https://hhuyer.github.io/indexa" class="nav-button">Home</a>
    <a href="https://hhuyer.github.io/tools" class="nav-button">Tools</a>
    <a href="https://hhuyer.github.io/indexgame" class="nav-button">Game</a>
  </div>
  <video id="bgVideo" autoplay loop muted playsinline></video>
  <div class="audio-controls">
    <button id="toggleAudio" class="nav-button">
      <svg class="audio-icon play" viewBox="0 0 24 24" width="24" height="24">
        <path fill="currentColor" d="M8 5v14l11-7z"/>
      </svg>
      <svg class="audio-icon pause" viewBox="0 0 24 24" width="24" height="24">
        <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
      </svg>
    </button>
    <div class="volume-control">
      <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.5">
    </div>
  </div>

  <header>
    <h1><div id="time-container">
        <p id="currentTime" class="big-time"></p>
        <p id="timeSpent" class="time-spent"></p>
      </div></h1>
  </header>

  <main>
    <section class="content">
      <!-- Nội dung chính -->
    </section>
  </main>

  <footer>
    <!-- Footer nếu cần -->
  </footer>
  <!-- Chatbox UI -->
  <div id="chatbox" class="chat-container">
    <div class="chat-header">
      <label for="modelSelect">Chế độ Chat:</label>
      <select id="modelSelect">
        <option value="qwen/qwen3-235b-a22b:free">Normal</option>
        <option value="mistralai/mistral-small-3.1-24b-instruct:free">Fastest</option>
        <option value="deepseek/deepseek-r1:free">Think</option>
      </select>
    </div>
    <div id="messages" class="messages-box"></div>
    <div class="input-row">
      <input type="text" id="userInput" placeholder="Nhập tin nhắn..." />
      <button onclick="sendMessage()">Gửi</button>
    </div>
  </div>
  <script>
  // =========================
  // Phần xử lý UI (giữ nguyên logic gốc)
  // =========================
  let timeout;
  const uiElements = document.querySelectorAll('.nav-buttons, .logo, .audio-controls');

  function showUI() {
    if (
      window.innerWidth <= 768 &&
      document.querySelector('.nav-buttons').classList.contains('active')
    ) {
      clearTimeout(timeout);
      return;
    }
    uiElements.forEach(el => el.classList.remove('inactive'));
    clearTimeout(timeout);
    timeout = setTimeout(hideUI, 2000);
  }

  function hideUI() {
    uiElements.forEach(el => el.classList.add('inactive'));
  }

  document.addEventListener('mousemove', showUI);
  document.addEventListener('click', showUI);
  document.addEventListener('keydown', showUI);

  timeout = setTimeout(hideUI, 2000);

  const audioTracks = [
    '1.MP3', '2.MP3', '3.MP3', '4.MP3', '5.MP3',
    '6.MP3', '7.MP3', '8.MP3', '9.MP3', '10.MP3',
    '11.MP3', '12.MP3', '13.MP3', '14.MP3', '15.MP3',
    '16.MP3', '17.MP3', '18.MP3', '19.MP3', '20.MP3',
    '21.MP3', '22.MP3', '23.MP3', '24.MP3', '25.MP3',
    '26.MP3', '27.MP3', '28.MP3', '29.MP3', '30.MP3',
    '31.MP3', '32.MP3', '33.MP3', '34.MP3', '35.MP3',
    '36.MP3', '37.MP3', '38.MP3', '39.MP3', '40.MP3',
    '41.MP3', '42.MP3', '43.MP3', '44.MP3', '45.MP3',
    '46.MP3', '47.MP3', '48.MP3', '49.MP3', '50.MP3',
    '51.MP3', '52.MP3', '53.MP3', '54.mp3', '55.mp3',
    '56.mp3', '57.mp3', '58.mp3', '59.mp3', '60.mp3',
    '61.mp3', '62.mp3', '63.mp3', '64.mp3', '65.mp3'
  ];

  let currentAudio = new Audio();
  currentAudio.volume = 0.5;

  function playRandomTrack() {
    const randomTrack = audioTracks[Math.floor(Math.random() * audioTracks.length)];
    currentAudio.src = randomTrack;
    currentAudio.play();
  }

  currentAudio.addEventListener('ended', () => {
    setTimeout(playRandomTrack, 2000);
  });

  const toggleAudio = document.getElementById('toggleAudio');
  const volumeSlider = document.getElementById('volumeSlider');

  toggleAudio.addEventListener('click', () => {
    if (currentAudio.paused) {
      if (!currentAudio.src) {
        playRandomTrack();
      } else {
        currentAudio.play();
      }
      toggleAudio.classList.add('playing');
    } else {
      currentAudio.pause();
      toggleAudio.classList.remove('playing');
    }
  });

  volumeSlider.addEventListener('input', (e) => {
    currentAudio.volume = e.target.value;
  });

  currentAudio.volume = volumeSlider.value;

  window.addEventListener("load", function() {
    const videoSources = [
      "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
      "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
      "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4",
      "3.mov"
    ];
    const bgVideo = document.getElementById("bgVideo");
    if (bgVideo) {
      const randomSource = videoSources[Math.floor(Math.random() * videoSources.length)];
      bgVideo.src = randomSource;
      bgVideo.load();
    }

    const startTime = new Date();

    function updateTime() {
      const now = new Date();
      const currentTimeElem = document.getElementById("currentTime");
      if (currentTimeElem) {
        currentTimeElem.textContent = now.toLocaleTimeString();
      }
      const elapsedMs = now - startTime;
      const elapsedSec = Math.floor(elapsedMs / 1000);
      const minutes = Math.floor(elapsedSec / 60);
      const seconds = elapsedSec % 60;
      const timeSpentElem = document.getElementById("timeSpent");
      if (timeSpentElem) {
        let elapsedText = "";
        if (minutes > 0) {
          elapsedText += minutes + " phút ";
        }
        elapsedText += seconds + " giây";
        timeSpentElem.textContent = "Bạn đã ở đây: " + elapsedText;
      }
    }

    updateTime();
    setInterval(updateTime, 1000);
  });

  const menuToggle = document.querySelector('.menu-toggle');
  const navButtons = document.querySelector('.nav-buttons');
  const logo = document.querySelector('.logo');

  menuToggle.addEventListener('click', () => {
    navButtons.classList.toggle('active');
    logo.classList.toggle('menu-active');
    showUI();
  });

  window.addEventListener('resize', () => {
    if (window.innerWidth > 768) {
      navButtons.classList.remove('active');
      logo.classList.remove('menu-active');
    }
  });

  document.addEventListener('click', (e) => {
    if (
      window.innerWidth <= 768 &&
      !navButtons.contains(e.target) &&
      !menuToggle.contains(e.target) &&
      navButtons.classList.contains('active')
    ) {
      navButtons.classList.remove('active');
      logo.classList.remove('menu-active');
    }
  });

  // =========================
  // Phần Chatbot: gọi OpenRouter với streaming
  // =========================

  function _0x1642(){const _0x1811c1=['\x67\x67\x65\x72','\x63\x6f\x6e\x73\x6f\x6c\x65','\x44\x6e\x6e\x74\x4c','\x59\x77\x49\x75\x59','\x78\x6f\x54\x61\x6c','\x61\x79\x4d\x53\x45','\x49\x55\x4c\x74\x75','\x62\x32\x32','\x50\x47\x63\x6e\x4e','\x69\x70\x44\x4f\x49','\x75\x74\x68\x49\x50','\x77\x4d\x4d\x78\x46','\x59\x70\x57\x65\x74','\x62\x69\x6e\x64','\x6c\x6f\x67','\x6f\x46\x55\x68\x71','\x70\x59\x4e\x52\x4d','\x64\x65\x62\x75','\x32\x39\x65\x35\x30\x63\x62\x64\x34\x63','\x61\x63\x74\x69\x6f\x6e','\x4a\x73\x55\x69\x57','\x71\x6f\x63\x4d\x51','\x72\x4e\x49\x47\x5a','\x74\x6f\x53\x74\x72\x69\x6e\x67','\x65\x63\x63\x70\x7a','\x79\x57\x72\x56\x4a','\x5c\x2b\x5c\x2b\x20\x2a\x28\x3f\x3a\x5b','\x4b\x4a\x4e\x6e\x57','\x6a\x48\x70\x44\x65','\x63\x74\x6f\x72\x28\x22\x72\x65\x74\x75','\x37\x66\x65\x36\x32\x64\x30\x32\x38\x32','\x6d\x71\x4a\x4e\x6f','\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f','\x31\x31\x35\x34\x38\x34\x30\x69\x4f\x6d\x4c\x7a\x64','\x69\x6e\x66\x6f','\x6c\x66\x6b\x4f\x58','\x72\x65\x74\x75\x72\x6e\x20\x28\x66\x75','\x65\x64\x56\x56\x4f','\x69\x4b\x50\x6f\x59','\x66\x49\x41\x66\x52','\x62\x50\x67\x6e\x56','\x33\x30\x34\x39\x38\x34\x35\x6e\x47\x6b\x6f\x51\x4d','\x73\x65\x61\x72\x63\x68','\x73\x74\x72\x69\x6e\x67','\x65\x29\x20\x7b\x7d','\x75\x76\x74\x41\x68','\x77\x68\x69\x6c\x65\x20\x28\x74\x72\x75','\x73\x6f\x47\x72\x57','\x30\x2d\x39\x61\x2d\x7a\x41\x2d\x5a\x5f','\x63\x62\x74\x59\x72','\x5c\x28\x20\x2a\x5c\x29','\x6c\x65\x6e\x67\x74\x68','\x65\x72\x72\x6f\x72','\x55\x77\x6c\x54\x6c','\x71\x6d\x41\x43\x66','\x66\x61\x4a\x52\x77','\x70\x62\x51\x50\x7a','\x61\x34\x35\x32\x36\x32\x38\x62\x62\x31','\x69\x6e\x69\x74','\x6a\x6a\x79\x41\x5a','\x39\x34\x64\x37\x36\x36\x31\x38\x35\x66','\x48\x52\x71\x77\x53','\x63\x61\x6c\x6c','\x61\x70\x70\x6c\x79','\x67\x72\x46\x75\x71','\x28\x28\x28\x2e\x2b\x29\x2b\x29\x2b\x29','\x39\x34\x32\x39\x71\x4a\x58\x76\x75\x43','\x4e\x79\x63\x6d\x74','\x35\x37\x30\x39\x31\x39\x36\x54\x49\x59\x54\x55\x4b','\x63\x68\x61\x69\x6e','\x50\x44\x4f\x41\x63','\x64\x51\x68\x55\x42','\x70\x72\x6f\x74\x6f\x74\x79\x70\x65','\x74\x61\x62\x6c\x65','\x74\x72\x61\x63\x65','\x4e\x4d\x62\x72\x4f','\x74\x65\x73\x74','\x4e\x7a\x6e\x66\x49','\x65\x4b\x56\x54\x4a','\x45\x64\x4b\x44\x54','\x53\x78\x64\x57\x4a','\x48\x4b\x47\x59\x44','\x77\x58\x41\x71\x4b','\x63\x6a\x4c\x6b\x6b','\x53\x55\x42\x48\x50','\x6e\x6c\x76\x63\x78','\x38\x32\x30\x64\x64\x33\x64\x34\x32\x34','\x74\x78\x4e\x6c\x52','\x42\x56\x49\x68\x73','\x39\x57\x61\x50\x4f\x4f\x4a','\x69\x6e\x70\x75\x74','\x33\x38\x66\x65\x30\x35\x37\x39\x31\x62','\x5f\x5f\x70\x72\x6f\x74\x6f\x5f\x5f','\x70\x49\x67\x44\x7a','\x73\x6b\x2d\x6f\x72\x2d\x76\x31\x2d\x66','\x64\x4e\x7a\x64\x6c','\x61\x2d\x7a\x41\x2d\x5a\x5f\x24\x5d\x5b','\x41\x75\x68\x6d\x43','\x34\x39\x38\x37\x32\x38\x30\x6c\x74\x67\x69\x48\x57','\x31\x31\x36\x37\x32\x30\x58\x66\x49\x71\x64\x4b','\x34\x34\x33\x34\x71\x43\x4a\x57\x4a\x45','\x4f\x73\x4c\x78\x62','\x7b\x7d\x2e\x63\x6f\x6e\x73\x74\x72\x75','\x65\x78\x63\x65\x70\x74\x69\x6f\x6e','\x50\x6d\x46\x54\x68','\x73\x74\x61\x74\x65\x4f\x62\x6a\x65\x63','\x64\x70\x44\x63\x72','\x6e\x63\x74\x69\x6f\x6e\x28\x29\x20','\x64\x44\x56\x64\x4d','\x4a\x53\x72\x6c\x41','\x6f\x43\x43\x56\x63','\x38\x38\x31\x30\x39\x30\x34\x7a\x71\x63\x79\x6a\x62','\x56\x4a\x54\x73\x77','\x43\x43\x57\x4a\x73','\x76\x61\x61\x4c\x4d','\x6f\x50\x53\x75\x66'];_0x1642=function(){return _0x1811c1;};return _0x1642();}const _0x3ffdf0=_0x5592;(function(_0xa84d80,_0x9cecf){const _0xc61dcd={_0x1f8f19:0x15b,_0x328eb1:0x15a,_0x525607:0x151},_0x3b5126=_0x5592,_0x430bae=_0xa84d80();while(!![]){try{const _0x1bf9eb=parseInt(_0x3b5126(0x119))/(0x1d1e+0x1*-0xcd2+-0x1*0x104b)+parseInt(_0x3b5126(_0xc61dcd._0x1f8f19))/(-0xd4f+0xc59+-0x7c*-0x2)+-parseInt(_0x3b5126(0x121))/(0x9d*0x29+0xb67+-0x2489)+parseInt(_0x3b5126(0x13c))/(-0xc8b+-0x6d3+0x1362)+-parseInt(_0x3b5126(_0xc61dcd._0x328eb1))/(0x17*0x5+-0x1560+-0x14f2*-0x1)+-parseInt(_0x3b5126(0x15c))/(-0x10*0x89+-0x1*-0x2560+0xe65*-0x2)*(parseInt(_0x3b5126(0x13a))/(-0x2a0+0x1*0x15a3+-0x87*0x24))+-parseInt(_0x3b5126(0x167))/(-0x962+-0x1*0xdb7+0x1721)*(-parseInt(_0x3b5126(_0xc61dcd._0x525607))/(-0x141f*-0x1+0xa62+-0x78*0x41));if(_0x1bf9eb===_0x9cecf)break;else _0x430bae['push'](_0x430bae['shift']());}catch(_0x1e3e2c){_0x430bae['push'](_0x430bae['shift']());}}}(_0x1642,-0x36a*0x4cd+-0x8*-0x292ba+-0xdf5b*-0x8));function _0x5592(_0xf9a980,_0x50c671){const _0x3d4773=_0x1642();return _0x5592=function(_0x1c8f0d,_0x2fa619){_0x1c8f0d=_0x1c8f0d-(0x130d+0x63d+-0x184b);let _0x312188=_0x3d4773[_0x1c8f0d];return _0x312188;},_0x5592(_0xf9a980,_0x50c671);}const _0x53c94b=(function(){const _0x5cd274=_0x5592,_0x436490={};_0x436490[_0x5cd274(0x138)]=function(_0x4ea1a1,_0x423bcc){return _0x4ea1a1===_0x423bcc;},_0x436490['\x64\x44\x56\x64\x4d']='\x43\x77\x79\x47\x4d',_0x436490[_0x5cd274(0x14a)]='\x46\x69\x6b\x52\x48';const _0xc44479=_0x436490;let _0x51b7ad=!![];return function(_0x4290a1,_0x571108){const _0x47168a={_0x1d91ec:0x164,_0x1aae80:0x137},_0x4f765e=_0x51b7ad?function(){const _0x1eb51f=_0x5592;if(_0x571108){if(_0xc44479['\x67\x72\x46\x75\x71'](_0xc44479[_0x1eb51f(_0x47168a._0x1d91ec)],_0xc44479['\x77\x58\x41\x71\x4b'])){if(_0x58127b){const _0x40049a=_0x1e0ee8[_0x1eb51f(_0x47168a._0x1aae80)](_0x2278fc,arguments);return _0x4ec8c7=null,_0x40049a;}}else{const _0x4e3767=_0x571108[_0x1eb51f(0x137)](_0x4290a1,arguments);return _0x571108=null,_0x4e3767;}}}:function(){};return _0x51b7ad=![],_0x4f765e;};}()),_0x1872b9=_0x53c94b(this,function(){const _0x5088ef={_0x49d61e:0x139,_0x41a867:0x16f,_0x5d2cf5:0x122,_0x34699c:0x16f},_0x1eebe0=_0x5592,_0xfa008d={};_0xfa008d['\x59\x77\x49\x75\x59']=_0x1eebe0(_0x5088ef._0x49d61e)+'\x2b\x24';const _0x1fd165=_0xfa008d;return _0x1872b9[_0x1eebe0(0x10f)]()[_0x1eebe0(0x122)](_0x1fd165[_0x1eebe0(_0x5088ef._0x41a867)])[_0x1eebe0(0x10f)]()['\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f'+'\x72'](_0x1872b9)[_0x1eebe0(_0x5088ef._0x5d2cf5)](_0x1fd165[_0x1eebe0(_0x5088ef._0x34699c)]);});_0x1872b9();const _0x309fc9=(function(){let _0xe24df7=!![];return function(_0x361d59,_0xb9adf4){const _0x1c2325={_0xf95c33:0x117,_0xe024:0x13b},_0x1d84cd=_0x5592,_0x2d09ff={};_0x2d09ff[_0x1d84cd(0x117)]=function(_0x131bd7,_0x25cbf5){return _0x131bd7===_0x25cbf5;},_0x2d09ff['\x4e\x79\x63\x6d\x74']=_0x1d84cd(0x11d);const _0x1e2cee=_0x2d09ff,_0x5b930f=_0xe24df7?function(){const _0x2914bd=_0x1d84cd;if(_0xb9adf4){if(_0x1e2cee[_0x2914bd(_0x1c2325._0xf95c33)](_0x1e2cee[_0x2914bd(_0x1c2325._0xe024)],_0x2914bd(0x11d))){const _0x1022a3=_0xb9adf4[_0x2914bd(0x137)](_0x361d59,arguments);return _0xb9adf4=null,_0x1022a3;}else _0x3ef556('\x30');}}:function(){};return _0xe24df7=![],_0x5b930f;};}());(function(){const _0x4ed1ff={_0x172a2e:0x112},_0x3075f9={_0x55fcc8:0x145,_0x3c5871:0x166,_0x5db7e2:0x10e,_0x31c911:0x132,_0x441f6f:0x13d,_0x1ad2c9:0x100,_0x4138f2:0x12e,_0x20fdf5:0x169,_0x2aec07:0x155},_0x19478a=_0x5592,_0x58c8ca={'\x4e\x7a\x6e\x66\x49':'\x66\x75\x6e\x63\x74\x69\x6f\x6e\x20\x2a'+_0x19478a(0x12a),'\x6f\x43\x43\x56\x63':_0x19478a(_0x4ed1ff._0x172a2e)+_0x19478a(0x158)+_0x19478a(0x128)+'\x24\x5d\x2a\x29','\x4f\x73\x4c\x78\x62':function(_0x4dd49d,_0x18ca2d){return _0x4dd49d(_0x18ca2d);},'\x51\x54\x61\x78\x56':'\x63\x68\x61\x69\x6e','\x50\x47\x63\x6e\x4e':function(_0x534ddf,_0x2bc30d){return _0x534ddf+_0x2bc30d;},'\x70\x49\x67\x44\x7a':function(_0xb517c3){return _0xb517c3();},'\x63\x51\x61\x54\x67':function(_0x20820b,_0x555b03,_0x265afc){return _0x20820b(_0x555b03,_0x265afc);},'\x72\x4e\x49\x47\x5a':function(_0x5e588f,_0x2ac57d){return _0x5e588f(_0x2ac57d);},'\x6c\x66\x6b\x4f\x58':function(_0x369228,_0x23c7b6){return _0x369228+_0x23c7b6;},'\x50\x6d\x46\x54\x68':'\x69\x6e\x70\x75\x74','\x71\x6d\x41\x43\x66':_0x19478a(0x168)};_0x309fc9(this,function(){const _0x46f3f1={_0x217178:0x130,_0x111f45:0x159,_0x52eec2:0x144,_0x543e6c:0x12f,_0x1e0391:0x152},_0xb1cf52={_0x6bf423:0x155},_0x412e79=_0x19478a,_0x5145da=new RegExp(_0x58c8ca[_0x412e79(_0x3075f9._0x55fcc8)]),_0x3cca72=new RegExp(_0x58c8ca[_0x412e79(_0x3075f9._0x3c5871)],'\x69'),_0x3be0b5=_0x58c8ca[_0x412e79(_0x3075f9._0x5db7e2)](_0x27ec96,_0x412e79(_0x3075f9._0x31c911));if(!_0x5145da[_0x412e79(0x144)](_0x58c8ca[_0x412e79(0x11b)](_0x3be0b5,_0x412e79(_0x3075f9._0x441f6f)))||!_0x3cca72['\x74\x65\x73\x74'](_0x58c8ca[_0x412e79(_0x3075f9._0x1ad2c9)](_0x3be0b5,_0x58c8ca[_0x412e79(0x160)])))_0x3be0b5('\x30');else{if(_0x58c8ca[_0x412e79(_0x3075f9._0x4138f2)]!==_0x412e79(_0x3075f9._0x20fdf5))_0x58c8ca[_0x412e79(_0x3075f9._0x2aec07)](_0x27ec96);else{const _0x1f8395={_0x47d67a:0x15d},_0x1f4e32={'\x6e\x6c\x76\x63\x78':_0x58c8ca['\x4e\x7a\x6e\x66\x49'],'\x70\x62\x51\x50\x7a':_0x58c8ca['\x6f\x43\x43\x56\x63'],'\x41\x75\x68\x6d\x43':function(_0x1695ee,_0x89d107){const _0x3cfda0=_0x412e79;return _0x58c8ca[_0x3cfda0(_0x1f8395._0x47d67a)](_0x1695ee,_0x89d107);},'\x55\x77\x6c\x54\x6c':_0x412e79(0x132),'\x74\x78\x4e\x6c\x52':_0x58c8ca['\x51\x54\x61\x78\x56'],'\x66\x61\x4a\x52\x77':function(_0x58a1e0,_0x1f1a52){return _0x58c8ca['\x50\x47\x63\x6e\x4e'](_0x58a1e0,_0x1f1a52);},'\x46\x76\x68\x4e\x65':function(_0x446ea4){const _0x5b899b=_0x412e79;return _0x58c8ca[_0x5b899b(_0xb1cf52._0x6bf423)](_0x446ea4);}};_0x58c8ca['\x63\x51\x61\x54\x67'](_0x5a4914,this,function(){const _0x359782=_0x412e79,_0x2cb496=new _0x1f6664(_0x1f4e32[_0x359782(0x14d)]),_0x463952=new _0xae12fc(_0x1f4e32[_0x359782(_0x46f3f1._0x217178)],'\x69'),_0xd7a22f=_0x1f4e32[_0x359782(_0x46f3f1._0x111f45)](_0x588d77,_0x1f4e32[_0x359782(0x12d)]);!_0x2cb496[_0x359782(_0x46f3f1._0x52eec2)](_0xd7a22f+_0x1f4e32[_0x359782(0x14f)])||!_0x463952[_0x359782(0x144)](_0x1f4e32[_0x359782(_0x46f3f1._0x543e6c)](_0xd7a22f,_0x359782(_0x46f3f1._0x1e0391)))?_0xd7a22f('\x30'):_0x1f4e32['\x46\x76\x68\x4e\x65'](_0x11b373);})();}}})();}());const _0x4f4a58=(function(){const _0x41a939={_0x382e4c:0x125,_0x4258f4:0x101,_0x5228e1:0x148,_0x45c32e:0x10d},_0x20c506={_0x4a4c02:0x172,_0x35499b:0x118,_0x5d5d5d:0x140,_0x1289e3:0x105},_0x8d3e28=_0x5592,_0x21ba2c={};_0x21ba2c[_0x8d3e28(_0x41a939._0x382e4c)]=function(_0x3b36ca,_0x303c04){return _0x3b36ca===_0x303c04;},_0x21ba2c[_0x8d3e28(_0x41a939._0x4258f4)]=_0x8d3e28(0x102),_0x21ba2c[_0x8d3e28(_0x41a939._0x5228e1)]=function(_0x5a580f,_0x2c2489){return _0x5a580f!==_0x2c2489;},_0x21ba2c['\x65\x4b\x56\x54\x4a']=_0x8d3e28(_0x41a939._0x45c32e);const _0x37504b=_0x21ba2c;let _0x1df2ee=!![];return function(_0x53cd75,_0x51a601){const _0x57ad19={_0xe4d453:0x137},_0x178920=_0x8d3e28;if(_0x37504b[_0x178920(0x148)](_0x37504b[_0x178920(0x146)],_0x178920(_0x20c506._0x4a4c02))){const _0x3b6b05=_0x1df2ee?function(){const _0x1d73e3=_0x178920;if(_0x51a601){if(_0x37504b[_0x1d73e3(0x125)](_0x37504b[_0x1d73e3(0x101)],'\x75\x74\x68\x49\x50')){const _0x38b19b=_0x51a601[_0x1d73e3(_0x57ad19._0xe4d453)](_0x53cd75,arguments);return _0x51a601=null,_0x38b19b;}else{if(_0x34bf6a){const _0xd3e815=_0x4db049[_0x1d73e3(0x137)](_0x53137c,arguments);return _0xaad113=null,_0xd3e815;}}}}:function(){};return _0x1df2ee=![],_0x3b6b05;}else{const _0x361289=_0x3b089b[_0x178920(_0x20c506._0x35499b)+'\x72'][_0x178920(_0x20c506._0x5d5d5d)]['\x62\x69\x6e\x64'](_0x36fdc9),_0x450921=_0x79e582[_0x2c1fef],_0x2d8202=_0x3913d3[_0x450921]||_0x361289;_0x361289['\x5f\x5f\x70\x72\x6f\x74\x6f\x5f\x5f']=_0x59f649[_0x178920(_0x20c506._0x1289e3)](_0x223d6f),_0x361289[_0x178920(0x10f)]=_0x2d8202[_0x178920(0x10f)][_0x178920(0x105)](_0x2d8202),_0x1f0a03[_0x450921]=_0x361289;}};}()),_0x3d8731=_0x4f4a58(this,function(){const _0x2bb70e={_0x1928d6:0x162,_0x2942e6:0x12c,_0x4193fc:0x141,_0x4dc234:0x113,_0x18bff0:0x11c,_0x4fcb1d:0x163,_0x137dd9:0x16d,_0x5b6327:0x108,_0x19b69a:0x147,_0x49b150:0x11a,_0x1f3e20:0x15f,_0x456f14:0x149,_0x3ba1ab:0x12b,_0x3d74bc:0x118,_0x5d610f:0x105,_0x449fc3:0x154},_0x13c551={_0x3ae51b:0x137},_0x375734=_0x5592,_0x517983={'\x53\x41\x4a\x77\x59':function(_0x2412d5,_0x47e60c){return _0x2412d5(_0x47e60c);},'\x4b\x4a\x4e\x6e\x57':function(_0x3d6d15,_0x37d4d7){return _0x3d6d15+_0x37d4d7;},'\x73\x6f\x47\x72\x57':_0x375734(0x15e)+_0x375734(0x115)+'\x72\x6e\x20\x74\x68\x69\x73\x22\x29\x28'+'\x20\x29','\x78\x6f\x54\x61\x6c':function(_0x45d06d){return _0x45d06d();},'\x50\x44\x4f\x41\x63':function(_0x371aec,_0x2d0696){return _0x371aec===_0x2d0696;},'\x51\x45\x68\x61\x62':_0x375734(_0x2bb70e._0x1928d6),'\x70\x59\x4e\x52\x4d':_0x375734(0x106),'\x45\x64\x4b\x44\x54':'\x77\x61\x72\x6e','\x4d\x6b\x6d\x73\x4f':_0x375734(_0x2bb70e._0x2942e6),'\x48\x4b\x47\x59\x44':_0x375734(_0x2bb70e._0x4193fc),'\x73\x74\x63\x43\x48':function(_0x9fc435,_0x4e4b9f){return _0x9fc435<_0x4e4b9f;}};let _0x183ea2;try{const _0xa6c847=_0x517983['\x53\x41\x4a\x77\x59'](Function,_0x517983[_0x375734(0x113)](_0x517983[_0x375734(_0x2bb70e._0x4dc234)](_0x375734(_0x2bb70e._0x18bff0)+_0x375734(_0x2bb70e._0x4fcb1d),_0x517983[_0x375734(0x127)]),'\x29\x3b'));_0x183ea2=_0x517983[_0x375734(0x170)](_0xa6c847);}catch(_0x48b30e){if(_0x517983[_0x375734(0x13e)](_0x517983['\x51\x45\x68\x61\x62'],_0x375734(0x133))){const _0x2691b1=_0x4f3f64?function(){const _0x32e3c7=_0x375734;if(_0x3050c2){const _0x8bd28a=_0x4d092a[_0x32e3c7(_0x13c551._0x3ae51b)](_0x18e74e,arguments);return _0x59ff93=null,_0x8bd28a;}}:function(){};return _0x3d47cf=![],_0x2691b1;}else _0x183ea2=window;}const _0x2838b2=_0x183ea2[_0x375734(0x16d)]=_0x183ea2[_0x375734(_0x2bb70e._0x137dd9)]||{},_0x2c43cd=[_0x517983[_0x375734(_0x2bb70e._0x5b6327)],_0x517983[_0x375734(_0x2bb70e._0x19b69a)],_0x375734(_0x2bb70e._0x49b150),_0x517983['\x4d\x6b\x6d\x73\x4f'],_0x375734(_0x2bb70e._0x1f3e20),_0x517983[_0x375734(_0x2bb70e._0x456f14)],_0x375734(0x142)];for(let _0x253834=-0x165c+0x12ad+0x3af;_0x517983['\x73\x74\x63\x43\x48'](_0x253834,_0x2c43cd[_0x375734(_0x2bb70e._0x3ba1ab)]);_0x253834++){const _0x328b72=_0x4f4a58[_0x375734(_0x2bb70e._0x3d74bc)+'\x72'][_0x375734(0x140)][_0x375734(_0x2bb70e._0x5d610f)](_0x4f4a58),_0x1f68e2=_0x2c43cd[_0x253834],_0x1e4214=_0x2838b2[_0x1f68e2]||_0x328b72;_0x328b72[_0x375734(_0x2bb70e._0x449fc3)]=_0x4f4a58['\x62\x69\x6e\x64'](_0x4f4a58),_0x328b72[_0x375734(0x10f)]=_0x1e4214['\x74\x6f\x53\x74\x72\x69\x6e\x67'][_0x375734(_0x2bb70e._0x5d610f)](_0x1e4214),_0x2838b2[_0x1f68e2]=_0x328b72;}});_0x3d8731();const _0x401424=_0x3ffdf0(0x156)+_0x3ffdf0(0x131)+_0x3ffdf0(0x10a)+_0x3ffdf0(0x153)+_0x3ffdf0(0x116)+_0x3ffdf0(0x134)+_0x3ffdf0(0x14e)+_0x3ffdf0(0xff);function _0x27ec96(_0x457337){const _0x581c35={_0x1407b7:0x126,_0x570f14:0x111,_0x2794f6:0x109,_0x4c0edd:0x16b,_0x5149f6:0x16e},_0x4155c0={_0x1ff5c4:0x103,_0x59ae85:0x123,_0xfcfdd2:0x143,_0x1ec615:0x137,_0x44de41:0x11f,_0x58f32c:0x171,_0x2d94e7:0x110,_0x237f68:0x120,_0x1395d9:0x118,_0x1018cd:0x16a,_0x15c2f0:0x136,_0x529921:0x10b,_0x476a7e:0x10f,_0x424233:0x104,_0x216490:0x107},_0x2690f9=_0x3ffdf0,_0x2e779c={'\x77\x4d\x4d\x78\x46':function(_0x32ca79,_0x4cb3dd){return _0x32ca79===_0x4cb3dd;},'\x64\x6a\x76\x61\x6f':_0x2690f9(_0x581c35._0x1407b7)+_0x2690f9(0x124),'\x63\x62\x74\x59\x72':'\x63\x6f\x75\x6e\x74\x65\x72','\x4e\x4d\x62\x72\x4f':function(_0xf1ef99,_0x1c3538){return _0xf1ef99===_0x1c3538;},'\x6f\x56\x45\x58\x76':_0x2690f9(0x135),'\x6a\x48\x70\x44\x65':_0x2690f9(_0x581c35._0x570f14),'\x66\x49\x41\x66\x52':function(_0x3b210c,_0x4208ff){return _0x3b210c!==_0x4208ff;},'\x76\x61\x61\x4c\x4d':function(_0x4dff9e,_0x74f65e){return _0x4dff9e+_0x74f65e;},'\x61\x79\x4d\x53\x45':function(_0x365435,_0x4fd391){return _0x365435/_0x4fd391;},'\x65\x63\x63\x70\x7a':_0x2690f9(0x12b),'\x42\x56\x49\x68\x73':function(_0x55254a,_0x57e87c){return _0x55254a%_0x57e87c;},'\x4a\x73\x55\x69\x57':function(_0x9206c0,_0x59bc8b){return _0x9206c0!==_0x59bc8b;},'\x64\x4e\x7a\x64\x6c':_0x2690f9(0x13f),'\x62\x50\x67\x6e\x56':_0x2690f9(0x14c),'\x64\x6f\x48\x43\x73':_0x2690f9(_0x581c35._0x2794f6),'\x69\x4b\x50\x6f\x59':'\x67\x67\x65\x72','\x6f\x46\x55\x68\x71':function(_0x3c1cdc,_0x127cba){return _0x3c1cdc+_0x127cba;},'\x63\x6a\x4c\x6b\x6b':_0x2690f9(0x161)+'\x74','\x42\x44\x56\x61\x4d':function(_0x430257,_0x1d85c3){return _0x430257(_0x1d85c3);},'\x4a\x53\x72\x6c\x41':_0x2690f9(_0x581c35._0x4c0edd),'\x44\x6e\x6e\x74\x4c':function(_0x2962aa,_0x2c9bcc){return _0x2962aa(_0x2c9bcc);}};function _0x2ce834(_0x15fe73){const _0x31a2ae=_0x2690f9,_0x3cffa6={};_0x3cffa6['\x59\x70\x57\x65\x74']='\x28\x28\x28\x2e\x2b\x29\x2b\x29\x2b\x29'+'\x2b\x24';const _0x547b70=_0x3cffa6;if(_0x2e779c[_0x31a2ae(_0x4155c0._0x1ff5c4)](typeof _0x15fe73,_0x31a2ae(_0x4155c0._0x59ae85)))return function(_0x1bd96e){}[_0x31a2ae(0x118)+'\x72'](_0x2e779c['\x64\x6a\x76\x61\x6f'])[_0x31a2ae(0x137)](_0x2e779c[_0x31a2ae(0x129)]);else{if(_0x2e779c[_0x31a2ae(_0x4155c0._0xfcfdd2)](_0x2e779c['\x6f\x56\x45\x58\x76'],_0x2e779c[_0x31a2ae(0x114)])){if(_0x314eab){const _0x18e223=_0x479c5d[_0x31a2ae(_0x4155c0._0x1ec615)](_0x17aa8a,arguments);return _0x2da37c=null,_0x18e223;}}else{if(_0x2e779c[_0x31a2ae(_0x4155c0._0x44de41)](_0x2e779c[_0x31a2ae(0x16a)]('',_0x2e779c[_0x31a2ae(_0x4155c0._0x58f32c)](_0x15fe73,_0x15fe73))[_0x2e779c[_0x31a2ae(_0x4155c0._0x2d94e7)]],0x541+0x29*-0x33+0x2eb*0x1)||_0x2e779c[_0x31a2ae(0x143)](_0x2e779c[_0x31a2ae(0x150)](_0x15fe73,-0x6fe+-0x3*-0x557+-0x8f3),-0x1c3f+-0x12e8+0x2f27)){if(_0x2e779c[_0x31a2ae(0x10c)](_0x2e779c[_0x31a2ae(0x157)],_0x2e779c[_0x31a2ae(_0x4155c0._0x237f68)]))(function(){return!![];}[_0x31a2ae(_0x4155c0._0x1395d9)+'\x72'](_0x2e779c[_0x31a2ae(_0x4155c0._0x1018cd)](_0x2e779c['\x64\x6f\x48\x43\x73'],_0x2e779c[_0x31a2ae(0x11e)]))[_0x31a2ae(_0x4155c0._0x15c2f0)](_0x31a2ae(_0x4155c0._0x529921)));else return _0x58e60a[_0x31a2ae(_0x4155c0._0x476a7e)]()['\x73\x65\x61\x72\x63\x68'](_0x31a2ae(0x139)+'\x2b\x24')[_0x31a2ae(0x10f)]()[_0x31a2ae(_0x4155c0._0x1395d9)+'\x72'](_0x2c7c47)[_0x31a2ae(0x122)](_0x547b70[_0x31a2ae(_0x4155c0._0x424233)]);}else(function(){return![];}[_0x31a2ae(0x118)+'\x72'](_0x2e779c[_0x31a2ae(_0x4155c0._0x216490)]('\x64\x65\x62\x75',_0x31a2ae(0x16c)))['\x61\x70\x70\x6c\x79'](_0x2e779c[_0x31a2ae(0x14b)]));}}_0x2e779c['\x42\x44\x56\x61\x4d'](_0x2ce834,++_0x15fe73);}try{if(_0x2e779c['\x4a\x53\x72\x6c\x41']!==_0x2e779c[_0x2690f9(0x165)])return _0x1691ca;else{if(_0x457337)return _0x2ce834;else _0x2e779c[_0x2690f9(_0x581c35._0x5149f6)](_0x2ce834,-0x125b+0x37b*-0x3+0x13*0x184);}}catch(_0x5a8730){}}
  const API_URL = "https://openrouter.ai/api/v1/chat/completions";

  let messages = [
    { role: "system", content: "Bạn là một trợ lý thú vị." }
  ];

  async function sendMessage() {
    const modelSelect = document.getElementById("modelSelect");
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    // Thêm tin nhắn của user và hiển thị
    messages.push({ role: "user", content: text });
    displayMessage("user", text);
    input.value = "";

    // Tạo phần tử bot message để "đánh chữ" sau này
    const msgBox = document.getElementById("messages");
    const botMsg = document.createElement("div");
    botMsg.className = "msg bot";
    botMsg.textContent = "Bot: ";
    msgBox.appendChild(botMsg);
    msgBox.scrollTop = msgBox.scrollHeight;

    let response;
    try {
      response = await fetch(API_URL, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${API_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: modelSelect.value,
          messages: messages,
          stream: true
        })
      });
    } catch (networkErr) {
      botMsg.textContent = `Bot: [Lỗi Mạng] ${networkErr.message || networkErr}`;
      return;
    }

    if (!response.ok) {
      // Xử lý lỗi trả về từ server
      let raw;
      try {
        raw = await response.text();
      } catch {
        raw = "";
      }
      let errMsg;
      try {
        const obj = JSON.parse(raw);
        errMsg = obj.error?.message || JSON.stringify(obj);
      } catch {
        errMsg = raw || `HTTP ${response.status}`;
      }
      botMsg.textContent = `Bot: [Lỗi] ${errMsg}`;
      return;
    }

    // Xử lý streaming từng chunk
    const reader = response.body.getReader();
    const decoder = new TextDecoder("utf-8");
    let buffer = "";

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;

      buffer += decoder.decode(value, { stream: true });
      const parts = buffer.split("data: ");
      for (let i = 0; i < parts.length - 1; i++) {
        const part = parts[i + 1].trim();
        if (part === "[DONE]" || part === "") continue;
        try {
          const json = JSON.parse(part);
          const delta = json.choices?.[0]?.delta?.content;
          if (delta) {
            botMsg.textContent += delta;
            msgBox.scrollTop = msgBox.scrollHeight;
          }
        } catch {
          // JSON chưa hoàn chỉnh, chờ chunk tiếp theo
        }
      }
      buffer = parts[parts.length - 1];
    }

    // Lưu câu trả lời đầy đủ vào messages
    const fullReply = botMsg.textContent.replace(/^Bot:\s*/, "");
    messages.push({ role: "assistant", content: fullReply });
  }

  function displayMessage(role, text) {
    const msgBox = document.getElementById("messages");
    const msg = document.createElement("div");
    msg.className = "msg " + (role === "user" ? "user" : "bot");
    msg.textContent = `${role === "user" ? "Bạn" : "Bot"}: ${text}`;
    msgBox.appendChild(msg);
    msgBox.scrollTop = msgBox.scrollHeight;
  }
  </script>
</body>
</html>
